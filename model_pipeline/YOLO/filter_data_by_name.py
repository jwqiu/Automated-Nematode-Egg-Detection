import os
import shutil

# === ğŸ”§ é…ç½®è·¯å¾„ï¼ˆè¯·è‡ªè¡Œä¿®æ”¹ï¼‰ ===
image_dir = r"/Users/chenyuqi/Desktop/images"
label_dir = r"/Users/chenyuqi/Desktop/masks"

# æ”¯æŒçš„å›¾ç‰‡åç¼€
image_exts = {".png", ".jpg", ".jpeg", ".tif", ".tiff", ".bmp"}

# =====================================
def get_stem(filename):
    """å»æ‰æ‰©å±•åï¼Œå¾—åˆ°æ–‡ä»¶åä¸»ä½“"""
    return os.path.splitext(filename)[0]

def list_label_stems(folder):
    """åˆ—å‡ºæ ‡æ³¨æ–‡ä»¶å¤¹ä¸­å­˜åœ¨çš„æ ‡æ³¨åï¼ˆ.roi æˆ–åŒåå­æ–‡ä»¶å¤¹ï¼‰"""
    stems = set()
    for fname in os.listdir(folder):
        fullpath = os.path.join(folder, fname)
        if os.path.isdir(fullpath):
            stems.add(fname)  # æ–‡ä»¶å¤¹å
        elif os.path.splitext(fname)[1].lower() == ".roi":
            stems.add(get_stem(fname))  # å•ä¸ª .roi æ–‡ä»¶å
    return stems

def main():
    if not os.path.isdir(image_dir):
        print(f"âŒ å›¾ç‰‡æ–‡ä»¶å¤¹ä¸å­˜åœ¨: {image_dir}")
        return
    if not os.path.isdir(label_dir):
        print(f"âŒ æ ‡æ³¨æ–‡ä»¶å¤¹ä¸å­˜åœ¨: {label_dir}")
        return

    # è·å–å›¾ç‰‡åé›†åˆ
    image_stems = {get_stem(f) for f in os.listdir(image_dir)
                   if os.path.splitext(f)[1].lower() in image_exts}

    # è·å–æ ‡æ³¨åé›†åˆ
    label_stems = list_label_stems(label_dir)

    print(f"ğŸ“¸ å›¾ç‰‡æ•°é‡: {len(image_stems)}")
    print(f"ğŸ·ï¸ æ ‡æ³¨æ•°é‡: {len(label_stems)}")

    # æ‰¾å‡ºæ— æ ‡æ³¨çš„å›¾ç‰‡
    orphan_stems = image_stems - label_stems
    print(f"âš ï¸ æ²¡æœ‰æ ‡æ³¨çš„å›¾ç‰‡: {len(orphan_stems)}")

    # åˆ é™¤æ²¡æœ‰æ ‡æ³¨çš„å›¾ç‰‡
    for fname in os.listdir(image_dir):
        stem, ext = os.path.splitext(fname)
        if ext.lower() in image_exts and stem in orphan_stems:
            img_path = os.path.join(image_dir, fname)
            os.remove(img_path)
            print(f"ğŸ—‘ï¸ å·²åˆ é™¤: {fname}")

    print("âœ… æ¸…ç†å®Œæˆï¼Œåªä¿ç•™æœ‰æ ‡æ³¨æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å›¾ç‰‡ã€‚")

if __name__ == "__main__":
    main()
